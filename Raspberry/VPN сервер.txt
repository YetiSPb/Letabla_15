Настройка VPN сервера

https://github.com/kylemanna/docker-openvpn

https://serveradmin.ru/kak-pravilno-vybrat-mtu-na-setevom-interfejse/


# база

# docker install
bash docker-install.sh

# управление
cd /home/openvpn-node

docker-compose down (up -d | restart)

# загрузка правил
bash ipt.sh

# создать серт (меняем user_test на своё)

cd /home/openvpn-node && docker run -v ./opt/_data:/etc/openvpn --rm -it kylemanna/openvpn easyrsa build-client-full user_base nopass
cd /home/openvpn-node/scripts && sh cfg-build.sh user_base

# далее сертификат копировать отсюда
# /home/openvpn-node/tmp/out.ovpn
# внимание. он перезаписывается при создании нового

#


-------------------------------------------
docker compose restart openvpn

GroundStation,10.0.12.100
Letabla_15,10.0.12.101
Letabla_10,10.0.12.102

Переменная окружения
export OVPN_DATA="/home/openvpn-node/opt/_data/"

Список клиентов
docker run --rm -it -v $OVPN_DATA:/etc/openvpn kylemanna/openvpn ovpn_listclients

Создание клиента
cd /home/openvpn-node && docker run -v ./opt/_data:/etc/openvpn --rm -it kylemanna/openvpn easyrsa build-client-full [USERNAME] nopass
cd /home/openvpn-node/scripts && sh cfg-build.sh [USERNAME]

Удаление клиента
docker run --rm -it -v $OVPN_DATA:/etc/openvpn kylemanna/openvpn ovpn_revokeclient [USERNAME] remove


Привязка IP 

В коныиг сервера вставить 
topology subnet

Разделение локалки и Интернета
в конфиге сервера закоментить
push "redirect-gateway def1 bypass-dhcp" 
Эта команда заставляет клиентов направлять весь трафик через сервер.
добавить
push "route 10.0.12.0 255.255.255.0"



cd /etc/openvpn/ccd/

nano [USERNAME]

вставить
ifconfig-push 10.0.12.100 255.255.255.0
