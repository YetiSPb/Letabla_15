Настройка VPN сервера

https://github.com/kylemanna/docker-openvpn

https://serveradmin.ru/kak-pravilno-vybrat-mtu-na-setevom-interfejse/


# база

# docker install
bash docker-install.sh

# управление
cd /home/openvpn-node

docker-compose down (up -d | restart)

# загрузка правил
bash ipt.sh

# создать серт (меняем user_test на своё)

cd /home/openvpn-node && docker run -v ./opt/_data:/etc/openvpn --rm -it kylemanna/openvpn easyrsa build-client-full user_base nopass
cd /home/openvpn-node/scripts && sh cfg-build.sh user_base

# далее сертификат копировать отсюда
# /home/openvpn-node/tmp/out.ovpn
# внимание. он перезаписывается при создании нового

#

-------------------------------------------
docker compose restart openvpn

Наземные станции от 100-109
GroundStation,10.0.12.101
OculusQuest,10.0.12.102

Летаблы от 111 до n
Letabla_15,10.0.12.111
Letabla_10,10.0.12.112


Переменная окружения
export OVPN_DATA="/home/openvpn-node/opt/_data/"

Список клиентов
docker run --rm -it -v $OVPN_DATA:/etc/openvpn kylemanna/openvpn ovpn_listclients

Создание клиента. внимание. он перезаписывается при создании нового
cd /home/openvpn-node && docker run -v ./opt/_data:/etc/openvpn --rm -it kylemanna/openvpn easyrsa build-client-full [USERNAME] nopass
cd /home/openvpn-node/scripts && sh cfg-build.sh [USERNAME]

далее сертификат копировать отсюда
/home/openvpn-node/tmp/out.ovpn
внимание. он перезаписывается при создании нового

Удаление клиента
docker run --rm -it -v $OVPN_DATA:/etc/openvpn kylemanna/openvpn ovpn_revokeclient [USERNAME] remove

Разделение локалки и Интернета
в конфиге сервера закоментить
push "redirect-gateway def1 bypass-dhcp" 
Эта команда заставляет клиентов направлять весь трафик через сервер.
добавить
push "route 10.0.12.0 255.255.255.0"


Привязка IP 
В конфиг сервера вставить 
topology subnet

cd /home/openvpn-node/opt/_data/ccd
создать файл с именем созданного сертификата
nano [USERNAME]

вставить
ifconfig-push [ip адрес] [маска]
